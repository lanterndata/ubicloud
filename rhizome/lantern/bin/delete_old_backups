#!/bin/env ruby
# frozen_string_literal: true

require "json"
require_relative "../../common/lib/util"
require_relative "../lib/common"

configure_hash = JSON.parse($stdin.read)

r "docker compose -f #{$compose_file} exec -T -u root postgresql bash -c 'GOOGLE_APPLICATION_CREDENTIALS=/tmp/google-application-credentials-wal-g.json /opt/bitnami/postgresql/bin/wal-g delete retain FULL 7 --after #{configure_hash["retain_after"]} --confirm'"
